define(["jquery","backbone","bootstrap","lib/business/businessHelper","BaseView","Tutorial","activationBanner","nougat","underscore","view/common/puiHelper","LaunchBanner","popover","invoicingTile"],function(e,t,n,r,i,s,o,u,a,f,l,c,h){"use strict";var p=[],d,v,m,g,y,b=i.extend({el:"#page",bannerWrapper:e(".betaBannerMainWrapper"),bannerArrow:e(".bannerBttnWrapper .bannerArrow"),showText:e(".bannerBttnWrapper .showText"),hideText:e(".bannerBttnWrapper .hideText"),csrf:e("#_csrf"),events:{"click .rowLink":"openAsPopup","click a#money-transfer-link":"showMoneyTransferModal","click .tax-report-portal":"trackClickTaxTile","click .confirm-fee":"trackICPlusLink","click a.workingCapital":"trackWorkingCapital"},fetchStudentsTile:function(){var n,s="main:businessweb:home::main:students-module::",o="summary/studentsTile",u="summary/inc/studentsTile",a=e(".students-tile"),f="main:businessweb:home::main",l="bizexpnodeweb/public/templates/summary/index.dust",c=function(){e(".studentName").click(function(e){r.fptiRecordClick(s,f,l,"student-details")}),e(".studentName").on("touchstart",function(e){r.fptiRecordClick(s,f,l,"student-details")}),e(".addStudentAccount").click(function(e){r.fptiRecordClick(s,f,l,"add-student-account")}),e(".addStudentAccount").on("touchstart",function(e){r.fptiRecordClick(s,f,l,"add-student-account")})};a.length>0&&(n=new i,n.model=new t.Model,r.simpleFetchAndRender(o,a,u,n,c,s))},fetchActivityTile:function(){var n,s="main:businessweb:home::main:activity-module::",o="summary/activityTile",u="summary/inc/activityTile",a=e(".activity-tile");v=u,a.length>0&&(n=new i,n.model=new t.Model,r.simpleFetchAndRender(o,a,u,n,null,s))},bannerShowHideClickHandler:function(e){this.hideText.is(":visible")?this.hideBanner(!0):this.showBanner(!0)},hideBanner:function(e){this.hideText.hide(),this.showText.show(),this.bannerArrow.removeClass("hideArrow").addClass("showArrow"),this.bannerWrapper.removeClass("show"),this.bannerWrapper.slideUp(),e&&this.bannerWrapper.attr("id")!=="pre_hard_launch"&&this.bannerWrapper.attr("id")!=="hard_launch"&&this.postBannerState(this.bannerWrapper.attr("id"),!1,this.csrf.val());var t="main:businessweb:home::main:::",n="main:businessweb:home::main",i="bizexpnodeweb/public/templates/summary/index.dust",s=this.bannerWrapper.attr("id")+"_banner_close";r.fptiRecordClick(t,n,i,s)},showBanner:function(e){this.showText.hide(),this.hideText.show(),this.bannerArrow.removeClass("showArrow").addClass("hideArrow"),this.bannerWrapper.removeClass("hide"),this.bannerWrapper.slideDown(),e&&this.bannerWrapper.attr("id")!=="pre_hard_launch"&&this.bannerWrapper.attr("id")!=="hard_launch"&&this.postBannerState(this.bannerWrapper.attr("id"),!0,this.csrf.val());var t="main:businessweb:home::main:::",n="main:businessweb:home::main",i="bizexpnodeweb/public/templates/summary/index.dust",s=this.bannerWrapper.attr("id")+"_banner_open";r.fptiRecordClick(t,n,i,s)},postBannerState:function(t,n){e.ajax({type:"GET",url:"summary/updateMerchantPreferences",data:"type="+t+"&isOpenState="+n,cache:!1}).done(function(e){}).fail(function(e){var t=e?e.getResponseHeader("location"):null;typeof t=="string"&&(window.location=t)})},setupTutorial:function(){e(".mer-notification-wrapper").attr("data-tutorial-title",e("#alertsTutorial").data("tutorial-title-input")).attr("data-tutorial-text",e("#alertsTutorial").data("tutorial-text-input")).attr("data-tutorial-progress",e("#alertsTutorial").data("tutorial-progress-input")).attr("data-tutorial-order",e("#alertsTutorial").data("tutorial-order-input")),e(".mer-settings-wrapper").attr("data-tutorial-title",e("#profileTutorial").data("tutorial-title-input")).attr("data-tutorial-text",e("#profileTutorial").data("tutorial-text-input")).attr("data-tutorial-progress",e("#profileTutorial").data("tutorial-progress-input")).attr("data-tutorial-order",e("#profileTutorial").data("tutorial-order-input")),e("#mer-nav-menu > ul > li.mer-more-menu").attr("data-tutorial-title",e("#moreTutorial").data("tutorial-title-input")).attr("data-tutorial-text",e("#moreTutorial").data("tutorial-text-input")).attr("data-tutorial-progress",e("#moreTutorial").data("tutorial-progress-input")).attr("data-tutorial-order",e("#moreTutorial").data("tutorial-order-input")).attr("end-tutorial-title",e("#endTutorial").data("tutorial-title-input")).attr("end-tutorial-text",e("#endTutorial").data("tutorial-text-input")).attr("end-tutorial-progress",e("#endTutorial").data("tutorial-progress-input")),e("#mer-nav-menu > ul > li.moneyLink").attr("data-tutorial-title",e("#moneyTutorial").data("tutorial-title-input")).attr("data-tutorial-text",e("#moneyTutorial").data("tutorial-text-input")).attr("data-tutorial-progress",e("#moneyTutorial").data("tutorial-progress-input")).attr("data-tutorial-order",e("#moneyTutorial").data("tutorial-order-input")),e("#mer-nav-menu > ul > li.activityLink").attr("data-tutorial-title",e("#activityTutorial").data("tutorial-title-input")).attr("data-tutorial-text",e("#activityTutorial").data("tutorial-text-input")).attr("data-tutorial-progress",e("#activityTutorial").data("tutorial-progress-input")).attr("data-tutorial-order",e("#activityTutorial").data("tutorial-order-input")),e("#mer-nav-menu > ul > li.reportsLink").attr("data-tutorial-title",e("#reportsTutorial").data("tutorial-title-input")).attr("data-tutorial-text",e("#reportsTutorial").data("tutorial-text-input")).attr("data-tutorial-progress",e("#reportsTutorial").data("tutorial-progress-input")).attr("data-tutorial-order",e("#reportsTutorial").data("tutorial-order-input")),e("#mer-nav-menu > ul li.tools-menu").attr("data-tutorial-title",e("#toolsTutorial").data("tutorial-title-input")).attr("data-tutorial-text",e("#toolsTutorial").data("tutorial-text-input")).attr("data-tutorial-progress",e("#toolsTutorial").data("tutorial-progress-input")).attr("data-tutorial-order",e("#toolsTutorial").data("tutorial-order-input"));var t;e(".money-tile > .sectionFooter").hasClass("sectionFooter")?t=e(".money-tile > .sectionFooter"):t=e(".money-tile"),t.attr("data-tutorial-title",e("#moneyTileTutorial").data("tutorial-title-input")).attr("data-tutorial-text",e("#moneyTileTutorial").data("tutorial-text-input")).attr("data-tutorial-progress",e("#moneyTileTutorial").data("tutorial-progress-input")).attr("data-tutorial-order",e("#moneyTileTutorial").data("tutorial-order-input")),e(".start-tutorial-popover").attr("data-tutorial-title",e("#tutorialIntro").data("tutorial-title-input")).attr("data-tutorial-text",e("#tutorialIntro").data("tutorial-text-input")).attr("data-tutorial-intro",e("#tutorialIntro").data("tutorial-intro-input")).attr("data-tutorial-progress",e("#tutorialIntro").data("tutorial-progress-input")).attr("data-tutorial-order",e("#tutorialIntro").data("tutorial-order-input")),e("#activity-tile").attr("data-tutorial-title",e("#activityTileTutorial").data("tutorial-title-input")).attr("data-tutorial-text",e("#activityTileTutorial").data("tutorial-text-input")).attr("data-tutorial-progress",e("#activityTileTutorial").data("tutorial-progress-input")).attr("data-tutorial-order",e("#activityTileTutorial").data("tutorial-order-input"));var n=function(e){},r=new s(document.body,{close:function(){this.dismissTutorial(),e(document).unbind("ajaxComplete",n),n=null}.bind(this)});e(document).ajaxComplete(n),setTimeout(r.scrollToTutorial.bind(r),0)},getCookieValue:function(e){var t=e+"=",n=document.cookie.split(";");for(var r=0;r<n.length;r++){var i=n[r];while(i.charAt(0)===" ")i=i.substring(1);if(i.indexOf(t)===0)return i.substring(t.length,i.length)}return null},showMoneyTransferModal:function(e){e.preventDefault();var t=this.$("#moneyTransferModal"),n="/moneytransfer";t.find("iframe").attr("src",n),t.modal("show")},closeMoneyTransferModal:function(){var e=this.$("#moneyTransferModal");e.modal("hide")},reloadBalance:function(){var t=this,n=e.ajax({url:"/businessexp/summary/moneyTile",method:"GET",dataType:"html",cache:!1});n.done(function(n){var r=e(n).find(".balance-list"),i=e.parseHTML(n),s=i.filter(function(e){return e.className.match("balance-list")});s.length&&t.$(".sectionContent.balance-list").html(s[0].innerHTML)})},toggleModalCloseBtn:function(){var e=this.$("#moneyTransferModal");e.toggleClass("hideCloseBtn")},initTransferPopover:function(){var e=this.$("#showMoneyPopover");if(e.size()&&e.data("showmoneypopover"))var t={pageName:"money-popover",template:"bizexpnodeweb/public/templates/summary/index.dust"},n=new c("#money-transfer-link",t)},initTransferModal:function(){var e=this.$("#moneyTransferModal");e.on("hidden.bs.modal",function(){e.find("iframe").removeAttr("src")});var t=window.addEventListener?"addEventListener":"attachEvent",n=window[t],r=t==="attachEvent"?"onmessage":"message";n(r,function(e){switch(e.data){case"reloadBalance":this.reloadBalance();break;case"toggleCloseBtn":this.toggleModalCloseBtn();break;case"closeModal":this.closeMoneyModal(e)}},!1)},trackClickTaxTile:function(e){var t="main:businessweb:home::main:tax-module::",n="main:businessweb:home::main",i="bizexpnodeweb/public/templates/summary/index.dust",s=e.currentTarget.className;r.fptiRecordClick(t,n,i,s)},trackICPlusLink:function(e){var t="main:businessweb:home::main:icplus-banner::",n="main:businessweb:home::main",i="bizexpnodeweb/public/templates/summary/index.dust",s=e.currentTarget.className;r.fptiRecordClick(t,n,i,s)},trackWorkingCapital:function(e){var t="main:businessweb:home::main:::",n="main:businessweb:home::main",i="bizexpnodeweb/public/templates/summary/inc/moneyTile.dust",s=e.currentTarget.className;r.fptiRecordClick(t,n,i,s)},initialize:function(){a.extend(this,f);var t=this;y=this,this.fetchActivityTile(),h.load(),this.fetchStudentsTile(),e(".mpi").length&&(e(".bannerWrapper").hasClass("show")?this.showBanner():this.hideBanner());var n;typeof n!="undefined"&&n!==null&&n("send","event","Merchant Log-In","Success","Hawk"),e(".bannerBttnWrapper").find("a").click(function(e){e.preventDefault(),t.bannerShowHideClickHandler(e)}),e(".bannerBttnWrapper").find("a").on("touchstart",function(e){e.preventDefault(),t.bannerShowHideClickHandler(e)}),this.initTransferModal(),this.initTransferPopover(),e(".partnerLink").find("a").click(function(e){var t="main:businessweb:home::main:::",n="main:businessweb:home::main",i="bizexpnodeweb/public/templates/summary/index.dust",s=e.currentTarget.id;r.fptiRecordClick(t,n,i,s)}),e(".partnerLink").find("a").on("touchstart",function(e){var t="main:businessweb:home::main:::",n="main:businessweb:home::main",i="bizexpnodeweb/public/templates/summary/index.dust",s=e.currentTarget.id;r.fptiRecordClick(t,n,i,s)}),e(".launchBannerMainWrapper .pp-take-tour").click(function(e){e.preventDefault(),this.setupTutorial()}.bind(this)),e(".mer-welcome-tour").click(function(e){e.preventDefault(),this.setupTutorial()}.bind(this))}});return e("body").on("viewLoaded",e.proxy(function(t,n){p.push(n),!m&&e(".pp-launch-banner").length&&(l.recordLaunchBannerImpression(),m=!0);if(!g&&e(".ic-plus-banner").length){var i="main:businessweb:home::main:icplus-banner::",s="main:businessweb:home::main",u="bizexpnodeweb/public/templates/summary/index.dust";r.fptiRecordImpression(i,s,u),g=!0}var a=y.getCookieValue("OpenWelcomeTour");a&&(document.cookie="OpenWelcomeTour=; expires=Thu, 01 Jan 1970 00:00:00 UTC; domain=.paypal.com; path=/;",y.setupTutorial()),window.PAYPAL&&!window.PAYPAL.backupjQuery&&e.fn.popover&&(window.PAYPAL.backupjQuery=e.fn),n==="activationBanner"&&window.PAYPAL&&window.PAYPAL.backupjQuery&&e.fn&&!e.fn.popover&&(e.fn=window.PAYPAL.backupjQuery);var f=p.indexOf(v)!==-1;d=d||p.indexOf("activationBanner")!==-1,f&&!d&&o.load(),f&&e("[data-toggle=tooltip]").tooltip({placement:"bottom",delay:{show:1e3,hide:10},template:'<div class="tooltip ppCustom"><div class="tooltip-arrow"></div><div class="tooltip-outer"><div class="tooltip-inner"></div></div></div>'})},this)),b});